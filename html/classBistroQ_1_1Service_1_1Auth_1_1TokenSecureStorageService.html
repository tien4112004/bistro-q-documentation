<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BistroQ: BistroQ.Service.Auth.TokenSecureStorageService Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">BistroQ
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('classBistroQ_1_1Service_1_1Auth_1_1TokenSecureStorageService.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="classBistroQ_1_1Service_1_1Auth_1_1TokenSecureStorageService-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">BistroQ.Service.Auth.TokenSecureStorageService Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>A secure storage service for authentication tokens, implementing the ITokenStorageService interface. This service provides methods to securely store, retrieve, and clear access and refresh tokens, using encryption to ensure sensitive data is protected.  
 <a href="#details">More...</a></p>
<div class="dynheader">
Inheritance diagram for BistroQ.Service.Auth.TokenSecureStorageService:</div>
<div class="dyncontent">
<div class="center"><img src="classBistroQ_1_1Service_1_1Auth_1_1TokenSecureStorageService__inherit__graph.png" border="0" usemap="#aBistroQ_8Service_8Auth_8TokenSecureStorageService_inherit__map" alt="Inheritance graph"/></div>
<map name="aBistroQ_8Service_8Auth_8TokenSecureStorageService_inherit__map" id="aBistroQ_8Service_8Auth_8TokenSecureStorageService_inherit__map">
<area shape="rect" title="A secure storage service for authentication tokens, implementing the ITokenStorageService interface...." alt="" coords="5,80,189,123"/>
<area shape="rect" href="interfaceBistroQ_1_1Domain_1_1Contracts_1_1Services_1_1ITokenStorageService.html" title="Provides methods for securely storing and retrieving authentication tokens, including access and refr..." alt="" coords="22,5,172,32"/>
<area shape="poly" title=" " alt="" coords="100,48,100,80,94,80,94,48"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for BistroQ.Service.Auth.TokenSecureStorageService:</div>
<div class="dyncontent">
<div class="center"><img src="classBistroQ_1_1Service_1_1Auth_1_1TokenSecureStorageService__coll__graph.png" border="0" usemap="#aBistroQ_8Service_8Auth_8TokenSecureStorageService_coll__map" alt="Collaboration graph"/></div>
<map name="aBistroQ_8Service_8Auth_8TokenSecureStorageService_coll__map" id="aBistroQ_8Service_8Auth_8TokenSecureStorageService_coll__map">
<area shape="rect" title="A secure storage service for authentication tokens, implementing the ITokenStorageService interface...." alt="" coords="5,80,189,123"/>
<area shape="rect" href="interfaceBistroQ_1_1Domain_1_1Contracts_1_1Services_1_1ITokenStorageService.html" title="Provides methods for securely storing and retrieving authentication tokens, including access and refr..." alt="" coords="22,5,172,32"/>
<area shape="poly" title=" " alt="" coords="100,48,100,80,94,80,94,48"/>
</map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ad4d627cb7404b497d18dba99d2ea2cde" id="r_ad4d627cb7404b497d18dba99d2ea2cde"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad4d627cb7404b497d18dba99d2ea2cde">TokenSecureStorageService</a> (<a class="el" href="interfaceBistroQ_1_1Domain_1_1Contracts_1_1Services_1_1IFileService.html">IFileService</a> fileService)</td></tr>
<tr class="separator:ad4d627cb7404b497d18dba99d2ea2cde"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad8c39e32e97725ac279b0d90afeec6da" id="r_ad8c39e32e97725ac279b0d90afeec6da"><td class="memItemLeft" align="right" valign="top">async Task&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ad8c39e32e97725ac279b0d90afeec6da">SaveTokensAsync</a> (<a class="el" href="classBistroQ_1_1Domain_1_1Dtos_1_1LoginResponseDto.html">LoginResponseDto</a> responseDto)</td></tr>
<tr class="memdesc:ad8c39e32e97725ac279b0d90afeec6da"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores the access and refresh tokens, along with additional information, from a login result.  <br /></td></tr>
<tr class="separator:ad8c39e32e97725ac279b0d90afeec6da"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94f63b8112965bdde3669181f9a0f8f5" id="r_a94f63b8112965bdde3669181f9a0f8f5"><td class="memItemLeft" align="right" valign="top">async Task&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a94f63b8112965bdde3669181f9a0f8f5">ClearTokensAsync</a> ()</td></tr>
<tr class="memdesc:a94f63b8112965bdde3669181f9a0f8f5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clears all stored tokens, including access and refresh tokens, to effectively log out the user.  <br /></td></tr>
<tr class="separator:a94f63b8112965bdde3669181f9a0f8f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4a00212bfa670acda9f50c978e2dc99e" id="r_a4a00212bfa670acda9f50c978e2dc99e"><td class="memItemLeft" align="right" valign="top">async Task&lt; string &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a4a00212bfa670acda9f50c978e2dc99e">GetAccessToken</a> ()</td></tr>
<tr class="memdesc:a4a00212bfa670acda9f50c978e2dc99e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the stored access token.  <br /></td></tr>
<tr class="separator:a4a00212bfa670acda9f50c978e2dc99e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac6527f20e5726f0a7ab1b0996580449" id="r_aac6527f20e5726f0a7ab1b0996580449"><td class="memItemLeft" align="right" valign="top">async Task&lt;(string refreshToken, string userId)&gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#aac6527f20e5726f0a7ab1b0996580449">GetRefreshToken</a> ()</td></tr>
<tr class="memdesc:aac6527f20e5726f0a7ab1b0996580449"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieves the stored refresh token along with the associated user ID.  <br /></td></tr>
<tr class="separator:aac6527f20e5726f0a7ab1b0996580449"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abd6142c75a8d381ec3eb38ec91d54be1" id="r_abd6142c75a8d381ec3eb38ec91d54be1"><td class="memItemLeft" align="right" valign="top">async Task&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#abd6142c75a8d381ec3eb38ec91d54be1">SaveAccessToken</a> (string accessToken)</td></tr>
<tr class="memdesc:abd6142c75a8d381ec3eb38ec91d54be1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stores the access token.  <br /></td></tr>
<tr class="separator:abd6142c75a8d381ec3eb38ec91d54be1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a918feb0ddf39fa6cec68997105307690" id="r_a918feb0ddf39fa6cec68997105307690"><td class="memItemLeft" align="right" valign="top">async Task&lt; string &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a918feb0ddf39fa6cec68997105307690">GetRoleAsync</a> ()</td></tr>
<tr class="memdesc:a918feb0ddf39fa6cec68997105307690"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current user's role.  <br /></td></tr>
<tr class="separator:a918feb0ddf39fa6cec68997105307690"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_interfaceBistroQ_1_1Domain_1_1Contracts_1_1Services_1_1ITokenStorageService"><td colspan="2" onclick="javascript:dynsection.toggleInherit('pub_methods_interfaceBistroQ_1_1Domain_1_1Contracts_1_1Services_1_1ITokenStorageService')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="interfaceBistroQ_1_1Domain_1_1Contracts_1_1Services_1_1ITokenStorageService.html">BistroQ.Domain.Contracts.Services.ITokenStorageService</a></td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>A secure storage service for authentication tokens, implementing the ITokenStorageService interface. This service provides methods to securely store, retrieve, and clear access and refresh tokens, using encryption to ensure sensitive data is protected. </p>

<p class="definition">Definition at line <a class="el" href="TokenSecureStorageService_8cs_source.html#l00015">15</a> of file <a class="el" href="TokenSecureStorageService_8cs_source.html">TokenSecureStorageService.cs</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="ad4d627cb7404b497d18dba99d2ea2cde" name="ad4d627cb7404b497d18dba99d2ea2cde"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad4d627cb7404b497d18dba99d2ea2cde">&#9670;&#160;</a></span>TokenSecureStorageService()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">BistroQ.Service.Auth.TokenSecureStorageService.TokenSecureStorageService </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="interfaceBistroQ_1_1Domain_1_1Contracts_1_1Services_1_1IFileService.html">IFileService</a></td>          <td class="paramname"><span class="paramname"><em>fileService</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p class="definition">Definition at line <a class="el" href="TokenSecureStorageService_8cs_source.html#l00023">23</a> of file <a class="el" href="TokenSecureStorageService_8cs_source.html">TokenSecureStorageService.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   24</span>    {</div>
<div class="line"><span class="lineno">   25</span>        _fileService = fileService;</div>
<div class="line"><span class="lineno">   26</span>        _semaphore = <span class="keyword">new</span> SemaphoreSlim(1, 1);</div>
<div class="line"><span class="lineno">   27</span>        _entropy = Encoding.UTF8.GetBytes(<span class="stringliteral">&quot;BistroQ&quot;</span>);</div>
<div class="line"><span class="lineno">   28</span>        <span class="comment">// File path will be: ./bin/x64/Debug/net7.0-windows10.0.19041.0\AppX\Data</span></div>
<div class="line"><span class="lineno">   29</span>        _folderPath = Path.Combine(AppContext.BaseDirectory, <span class="stringliteral">&quot;Data&quot;</span>);</div>
<div class="line"><span class="lineno">   30</span>        _fileName = <span class="stringliteral">&quot;tokens.dat&quot;</span>;</div>
<div class="line"><span class="lineno">   31</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a94f63b8112965bdde3669181f9a0f8f5" name="a94f63b8112965bdde3669181f9a0f8f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a94f63b8112965bdde3669181f9a0f8f5">&#9670;&#160;</a></span>ClearTokensAsync()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async Task BistroQ.Service.Auth.TokenSecureStorageService.ClearTokensAsync </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Clears all stored tokens, including access and refresh tokens, to effectively log out the user. </p>
<dl class="section return"><dt>Returns</dt><dd>A task that represents the asynchronous clear operation.</dd></dl>

<p>Implements <a class="el" href="interfaceBistroQ_1_1Domain_1_1Contracts_1_1Services_1_1ITokenStorageService.html#a2120592f856362982de1b371553efef8">BistroQ.Domain.Contracts.Services.ITokenStorageService</a>.</p>

<p class="definition">Definition at line <a class="el" href="TokenSecureStorageService_8cs_source.html#l00067">67</a> of file <a class="el" href="TokenSecureStorageService_8cs_source.html">TokenSecureStorageService.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   68</span>    {</div>
<div class="line"><span class="lineno">   69</span>        await _semaphore.WaitAsync();</div>
<div class="line"><span class="lineno">   70</span> </div>
<div class="line"><span class="lineno">   71</span>        <span class="keywordflow">try</span></div>
<div class="line"><span class="lineno">   72</span>        {</div>
<div class="line"><span class="lineno">   73</span>            await Task.Run(() =&gt;</div>
<div class="line"><span class="lineno">   74</span>            {</div>
<div class="line"><span class="lineno">   75</span>                _fileService.<a class="code hl_function" href="interfaceBistroQ_1_1Domain_1_1Contracts_1_1Services_1_1IFileService.html#a28399ab6ce0afd9dd8158848548757a5">Delete</a>(_folderPath, _fileName);</div>
<div class="line"><span class="lineno">   76</span>            });</div>
<div class="line"><span class="lineno">   77</span>        }</div>
<div class="line"><span class="lineno">   78</span>        <span class="keywordflow">finally</span></div>
<div class="line"><span class="lineno">   79</span>        {</div>
<div class="line"><span class="lineno">   80</span>            _semaphore.Release();</div>
<div class="line"><span class="lineno">   81</span>        }</div>
<div class="line"><span class="lineno">   82</span>    }</div>
<div class="ttc" id="ainterfaceBistroQ_1_1Domain_1_1Contracts_1_1Services_1_1IFileService_html_a28399ab6ce0afd9dd8158848548757a5"><div class="ttname"><a href="interfaceBistroQ_1_1Domain_1_1Contracts_1_1Services_1_1IFileService.html#a28399ab6ce0afd9dd8158848548757a5">BistroQ.Domain.Contracts.Services.IFileService.Delete</a></div><div class="ttdeci">void Delete(string folderPath, string fileName)</div><div class="ttdoc">Deletes a file from the specified folder if it exists.</div></div>
</div><!-- fragment -->
</div>
</div>
<a id="a4a00212bfa670acda9f50c978e2dc99e" name="a4a00212bfa670acda9f50c978e2dc99e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4a00212bfa670acda9f50c978e2dc99e">&#9670;&#160;</a></span>GetAccessToken()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async Task&lt; string &gt; BistroQ.Service.Auth.TokenSecureStorageService.GetAccessToken </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieves the stored access token. </p>
<dl class="section return"><dt>Returns</dt><dd>A task that represents the asynchronous retrieval operation. The task result contains the stored access token as a string.</dd></dl>

<p>Implements <a class="el" href="interfaceBistroQ_1_1Domain_1_1Contracts_1_1Services_1_1ITokenStorageService.html#a0f236032749b9b86ab13cf14cdb723da">BistroQ.Domain.Contracts.Services.ITokenStorageService</a>.</p>

<p class="definition">Definition at line <a class="el" href="TokenSecureStorageService_8cs_source.html#l00084">84</a> of file <a class="el" href="TokenSecureStorageService_8cs_source.html">TokenSecureStorageService.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   85</span>    {</div>
<div class="line"><span class="lineno">   86</span>        await _semaphore.WaitAsync();</div>
<div class="line"><span class="lineno">   87</span> </div>
<div class="line"><span class="lineno">   88</span>        <span class="keywordflow">try</span></div>
<div class="line"><span class="lineno">   89</span>        {</div>
<div class="line"><span class="lineno">   90</span>            var tokens = await Task.Run(() =&gt;</div>
<div class="line"><span class="lineno">   91</span>            {</div>
<div class="line"><span class="lineno">   92</span>                <span class="keywordflow">return</span> _fileService.Read&lt;Dictionary&lt;string, string&gt;&gt;(_folderPath, _fileName);</div>
<div class="line"><span class="lineno">   93</span>            });</div>
<div class="line"><span class="lineno">   94</span> </div>
<div class="line"><span class="lineno">   95</span>            <span class="keywordflow">if</span> (tokens == <span class="keyword">null</span> || !tokens.ContainsKey(<span class="stringliteral">&quot;AccessToken&quot;</span>))</div>
<div class="line"><span class="lineno">   96</span>            {</div>
<div class="line"><span class="lineno">   97</span>                <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code hl_class" href="classBistroQ_1_1Domain_1_1Models_1_1Exceptions_1_1TokenStorageException.html">TokenStorageException</a>(<span class="stringliteral">&quot;No access token found&quot;</span>);</div>
<div class="line"><span class="lineno">   98</span>            }</div>
<div class="line"><span class="lineno">   99</span> </div>
<div class="line"><span class="lineno">  100</span>            <span class="keywordflow">return</span> await DecryptData(tokens[<span class="stringliteral">&quot;AccessToken&quot;</span>]);</div>
<div class="line"><span class="lineno">  101</span>        }</div>
<div class="line"><span class="lineno">  102</span>        <span class="keywordflow">finally</span></div>
<div class="line"><span class="lineno">  103</span>        {</div>
<div class="line"><span class="lineno">  104</span>            _semaphore.Release();</div>
<div class="line"><span class="lineno">  105</span>        }</div>
<div class="line"><span class="lineno">  106</span>    }</div>
<div class="ttc" id="aclassBistroQ_1_1Domain_1_1Models_1_1Exceptions_1_1TokenStorageException_html"><div class="ttname"><a href="classBistroQ_1_1Domain_1_1Models_1_1Exceptions_1_1TokenStorageException.html">BistroQ.Domain.Models.Exceptions.TokenStorageException</a></div><div class="ttdef"><b>Definition</b> <a href="TokenStorageException_8cs_source.html#l00009">TokenStorageException.cs:10</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a id="aac6527f20e5726f0a7ab1b0996580449" name="aac6527f20e5726f0a7ab1b0996580449"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aac6527f20e5726f0a7ab1b0996580449">&#9670;&#160;</a></span>GetRefreshToken()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async Task&lt;(string refreshToken, string userId)&gt; BistroQ.Service.Auth.TokenSecureStorageService.GetRefreshToken </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieves the stored refresh token along with the associated user ID. </p>
<dl class="section return"><dt>Returns</dt><dd>A task that represents the asynchronous retrieval operation. The task result contains a tuple with the refresh token and user ID.</dd></dl>

<p>Implements <a class="el" href="interfaceBistroQ_1_1Domain_1_1Contracts_1_1Services_1_1ITokenStorageService.html#ac358938628059b1eda1e5afc9c1916bd">BistroQ.Domain.Contracts.Services.ITokenStorageService</a>.</p>

<p class="definition">Definition at line <a class="el" href="TokenSecureStorageService_8cs_source.html#l00108">108</a> of file <a class="el" href="TokenSecureStorageService_8cs_source.html">TokenSecureStorageService.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  109</span>    {</div>
<div class="line"><span class="lineno">  110</span>        await _semaphore.WaitAsync();</div>
<div class="line"><span class="lineno">  111</span> </div>
<div class="line"><span class="lineno">  112</span>        <span class="keywordflow">try</span></div>
<div class="line"><span class="lineno">  113</span>        {</div>
<div class="line"><span class="lineno">  114</span>            var tokens = await Task.Run(() =&gt;</div>
<div class="line"><span class="lineno">  115</span>            {</div>
<div class="line"><span class="lineno">  116</span>                <span class="keywordflow">return</span> _fileService.Read&lt;Dictionary&lt;string, string&gt;&gt;(_folderPath, _fileName);</div>
<div class="line"><span class="lineno">  117</span>            });</div>
<div class="line"><span class="lineno">  118</span> </div>
<div class="line"><span class="lineno">  119</span>            <span class="keywordflow">if</span> (tokens == <span class="keyword">null</span> || !tokens.ContainsKey(<span class="stringliteral">&quot;AccessToken&quot;</span>) || !tokens.ContainsKey(<span class="stringliteral">&quot;UserId&quot;</span>))</div>
<div class="line"><span class="lineno">  120</span>            {</div>
<div class="line"><span class="lineno">  121</span>                <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code hl_class" href="classBistroQ_1_1Domain_1_1Models_1_1Exceptions_1_1TokenStorageException.html">TokenStorageException</a>(<span class="stringliteral">&quot;No tokens found&quot;</span>);</div>
<div class="line"><span class="lineno">  122</span>            }</div>
<div class="line"><span class="lineno">  123</span> </div>
<div class="line"><span class="lineno">  124</span>            <span class="keywordflow">return</span> (</div>
<div class="line"><span class="lineno">  125</span>                await DecryptData(tokens[<span class="stringliteral">&quot;RefreshToken&quot;</span>]),</div>
<div class="line"><span class="lineno">  126</span>                await DecryptData(tokens[<span class="stringliteral">&quot;UserId&quot;</span>])</div>
<div class="line"><span class="lineno">  127</span>            );</div>
<div class="line"><span class="lineno">  128</span>        }</div>
<div class="line"><span class="lineno">  129</span>        <span class="keywordflow">finally</span></div>
<div class="line"><span class="lineno">  130</span>        {</div>
<div class="line"><span class="lineno">  131</span>            _semaphore.Release();</div>
<div class="line"><span class="lineno">  132</span>        }</div>
<div class="line"><span class="lineno">  133</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="a918feb0ddf39fa6cec68997105307690" name="a918feb0ddf39fa6cec68997105307690"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a918feb0ddf39fa6cec68997105307690">&#9670;&#160;</a></span>GetRoleAsync()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async Task&lt; string &gt; BistroQ.Service.Auth.TokenSecureStorageService.GetRoleAsync </td>
          <td>(</td>
          <td class="paramname"><span class="paramname"><em></em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the current user's role. </p>
<dl class="section return"><dt>Returns</dt><dd>User's role</dd></dl>

<p>Implements <a class="el" href="interfaceBistroQ_1_1Domain_1_1Contracts_1_1Services_1_1ITokenStorageService.html#a52dbbf2df193952e1f3a77fa153b201c">BistroQ.Domain.Contracts.Services.ITokenStorageService</a>.</p>

<p class="definition">Definition at line <a class="el" href="TokenSecureStorageService_8cs_source.html#l00163">163</a> of file <a class="el" href="TokenSecureStorageService_8cs_source.html">TokenSecureStorageService.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  164</span>    {</div>
<div class="line"><span class="lineno">  165</span>        await _semaphore.WaitAsync();</div>
<div class="line"><span class="lineno">  166</span> </div>
<div class="line"><span class="lineno">  167</span>        <span class="keywordflow">try</span></div>
<div class="line"><span class="lineno">  168</span>        {</div>
<div class="line"><span class="lineno">  169</span>            var result = await Task.Run(() =&gt;</div>
<div class="line"><span class="lineno">  170</span>            {</div>
<div class="line"><span class="lineno">  171</span>                <span class="keywordflow">return</span> _fileService.Read&lt;Dictionary&lt;string, string&gt;&gt;(_folderPath, _fileName);</div>
<div class="line"><span class="lineno">  172</span>            });</div>
<div class="line"><span class="lineno">  173</span>            <span class="keywordflow">if</span> (result == <span class="keyword">null</span> || !result.ContainsKey(<span class="stringliteral">&quot;Role&quot;</span>))</div>
<div class="line"><span class="lineno">  174</span>            {</div>
<div class="line"><span class="lineno">  175</span>                <span class="keywordflow">return</span> <span class="stringliteral">&quot;User&quot;</span>;</div>
<div class="line"><span class="lineno">  176</span>            }</div>
<div class="line"><span class="lineno">  177</span> </div>
<div class="line"><span class="lineno">  178</span>            <span class="keywordflow">return</span> await DecryptData(result[<span class="stringliteral">&quot;Role&quot;</span>]);</div>
<div class="line"><span class="lineno">  179</span>        }</div>
<div class="line"><span class="lineno">  180</span>        <span class="keywordflow">finally</span></div>
<div class="line"><span class="lineno">  181</span>        {</div>
<div class="line"><span class="lineno">  182</span>            _semaphore.Release();</div>
<div class="line"><span class="lineno">  183</span>        }</div>
<div class="line"><span class="lineno">  184</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="abd6142c75a8d381ec3eb38ec91d54be1" name="abd6142c75a8d381ec3eb38ec91d54be1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abd6142c75a8d381ec3eb38ec91d54be1">&#9670;&#160;</a></span>SaveAccessToken()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async Task BistroQ.Service.Auth.TokenSecureStorageService.SaveAccessToken </td>
          <td>(</td>
          <td class="paramtype">string</td>          <td class="paramname"><span class="paramname"><em>accessToken</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Stores the access token. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">accessToken</td><td>The access token to store.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A task that represents the asynchronous save operation.</dd></dl>

<p>Implements <a class="el" href="interfaceBistroQ_1_1Domain_1_1Contracts_1_1Services_1_1ITokenStorageService.html#a6031bec524c9bfadd16684db2aa1df9e">BistroQ.Domain.Contracts.Services.ITokenStorageService</a>.</p>

<p class="definition">Definition at line <a class="el" href="TokenSecureStorageService_8cs_source.html#l00135">135</a> of file <a class="el" href="TokenSecureStorageService_8cs_source.html">TokenSecureStorageService.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">  136</span>    {</div>
<div class="line"><span class="lineno">  137</span>        await _semaphore.WaitAsync();</div>
<div class="line"><span class="lineno">  138</span> </div>
<div class="line"><span class="lineno">  139</span>        <span class="keywordflow">try</span></div>
<div class="line"><span class="lineno">  140</span>        {</div>
<div class="line"><span class="lineno">  141</span>            var result = await Task.Run(() =&gt;</div>
<div class="line"><span class="lineno">  142</span>            {</div>
<div class="line"><span class="lineno">  143</span>                <span class="keywordflow">return</span> _fileService.Read&lt;Dictionary&lt;string, string&gt;&gt;(_folderPath, _fileName);</div>
<div class="line"><span class="lineno">  144</span>            });</div>
<div class="line"><span class="lineno">  145</span>            <span class="keywordflow">if</span> (result == <span class="keyword">null</span>)</div>
<div class="line"><span class="lineno">  146</span>            {</div>
<div class="line"><span class="lineno">  147</span>                <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code hl_class" href="classBistroQ_1_1Domain_1_1Models_1_1Exceptions_1_1TokenStorageException.html">TokenStorageException</a>(<span class="stringliteral">&quot;No tokens found&quot;</span>);</div>
<div class="line"><span class="lineno">  148</span>            }</div>
<div class="line"><span class="lineno">  149</span> </div>
<div class="line"><span class="lineno">  150</span>            result[<span class="stringliteral">&quot;AccessToken&quot;</span>] = await EncryptData(accessToken);</div>
<div class="line"><span class="lineno">  151</span> </div>
<div class="line"><span class="lineno">  152</span>            await Task.Run(() =&gt;</div>
<div class="line"><span class="lineno">  153</span>            {</div>
<div class="line"><span class="lineno">  154</span>                _fileService.Save(_folderPath, _fileName, result);</div>
<div class="line"><span class="lineno">  155</span>            });</div>
<div class="line"><span class="lineno">  156</span>        }</div>
<div class="line"><span class="lineno">  157</span>        <span class="keywordflow">finally</span></div>
<div class="line"><span class="lineno">  158</span>        {</div>
<div class="line"><span class="lineno">  159</span>            _semaphore.Release();</div>
<div class="line"><span class="lineno">  160</span>        }</div>
<div class="line"><span class="lineno">  161</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<a id="ad8c39e32e97725ac279b0d90afeec6da" name="ad8c39e32e97725ac279b0d90afeec6da"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad8c39e32e97725ac279b0d90afeec6da">&#9670;&#160;</a></span>SaveTokensAsync()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">async Task BistroQ.Service.Auth.TokenSecureStorageService.SaveTokensAsync </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classBistroQ_1_1Domain_1_1Dtos_1_1LoginResponseDto.html">LoginResponseDto</a></td>          <td class="paramname"><span class="paramname"><em>responseDto</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Stores the access and refresh tokens, along with additional information, from a login result. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">responseDto</td><td>The login result containing tokens and other authentication details.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A task that represents the asynchronous save operation.</dd></dl>

<p>Implements <a class="el" href="interfaceBistroQ_1_1Domain_1_1Contracts_1_1Services_1_1ITokenStorageService.html#a914d4a780bf5b08ec6d726e800fc3b70">BistroQ.Domain.Contracts.Services.ITokenStorageService</a>.</p>

<p class="definition">Definition at line <a class="el" href="TokenSecureStorageService_8cs_source.html#l00032">32</a> of file <a class="el" href="TokenSecureStorageService_8cs_source.html">TokenSecureStorageService.cs</a>.</p>
<div class="fragment"><div class="line"><span class="lineno">   33</span>    {</div>
<div class="line"><span class="lineno">   34</span>        await _semaphore.WaitAsync();</div>
<div class="line"><span class="lineno">   35</span> </div>
<div class="line"><span class="lineno">   36</span>        var res = <span class="keyword">new</span> Dictionary&lt;string, string&gt;()</div>
<div class="line"><span class="lineno">   37</span>        {</div>
<div class="line"><span class="lineno">   38</span>            { <span class="stringliteral">&quot;AccessToken&quot;</span>, <span class="keyword">null</span> },</div>
<div class="line"><span class="lineno">   39</span>            { <span class="stringliteral">&quot;RefreshToken&quot;</span>, <span class="keyword">null</span> },</div>
<div class="line"><span class="lineno">   40</span>            { <span class="stringliteral">&quot;UserId&quot;</span>, <span class="keyword">null</span> },</div>
<div class="line"><span class="lineno">   41</span>            { <span class="stringliteral">&quot;Role&quot;</span>, <span class="keyword">null</span> }</div>
<div class="line"><span class="lineno">   42</span>        };</div>
<div class="line"><span class="lineno">   43</span> </div>
<div class="line"><span class="lineno">   44</span>        var tasks = <span class="keyword">new</span> Task[]</div>
<div class="line"><span class="lineno">   45</span>        {</div>
<div class="line"><span class="lineno">   46</span>            Task.Run(async () =&gt; res[<span class="stringliteral">&quot;AccessToken&quot;</span>] = await EncryptData(responseDto.AccessToken)),</div>
<div class="line"><span class="lineno">   47</span>            Task.Run(async () =&gt; res[<span class="stringliteral">&quot;RefreshToken&quot;</span>] = await EncryptData(responseDto.RefreshToken)),</div>
<div class="line"><span class="lineno">   48</span>            Task.Run(async () =&gt; res[<span class="stringliteral">&quot;UserId&quot;</span>] = await EncryptData(responseDto.UserId)),</div>
<div class="line"><span class="lineno">   49</span>            Task.Run(async () =&gt; res[<span class="stringliteral">&quot;Role&quot;</span>] = await EncryptData(responseDto.Role))</div>
<div class="line"><span class="lineno">   50</span>        };</div>
<div class="line"><span class="lineno">   51</span> </div>
<div class="line"><span class="lineno">   52</span>        <span class="keywordflow">try</span></div>
<div class="line"><span class="lineno">   53</span>        {</div>
<div class="line"><span class="lineno">   54</span>            await Task.WhenAll(tasks);</div>
<div class="line"><span class="lineno">   55</span> </div>
<div class="line"><span class="lineno">   56</span>            await Task.Run(() =&gt;</div>
<div class="line"><span class="lineno">   57</span>            {</div>
<div class="line"><span class="lineno">   58</span>                _fileService.Save(_folderPath, _fileName, res);</div>
<div class="line"><span class="lineno">   59</span>            });</div>
<div class="line"><span class="lineno">   60</span>        }</div>
<div class="line"><span class="lineno">   61</span>        <span class="keywordflow">finally</span></div>
<div class="line"><span class="lineno">   62</span>        {</div>
<div class="line"><span class="lineno">   63</span>            _semaphore.Release();</div>
<div class="line"><span class="lineno">   64</span>        }</div>
<div class="line"><span class="lineno">   65</span>    }</div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>BistroQ.Service/Auth/<a class="el" href="TokenSecureStorageService_8cs_source.html">TokenSecureStorageService.cs</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespaceBistroQ.html">BistroQ</a></li><li class="navelem"><a class="el" href="namespaceBistroQ_1_1Service.html">Service</a></li><li class="navelem"><a class="el" href="namespaceBistroQ_1_1Service_1_1Auth.html">Auth</a></li><li class="navelem"><a class="el" href="classBistroQ_1_1Service_1_1Auth_1_1TokenSecureStorageService.html">TokenSecureStorageService</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
